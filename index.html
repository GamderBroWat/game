<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mario Mobile</title>

<meta name="viewport"
content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#5c94fc;
  touch-action:none;
  height:100%;
}
canvas{display:block}

/* ROTATE SCREEN */
#rotateHint{
  position:fixed;
  inset:0;
  background:#5c94fc;
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  z-index:999;
  text-align:center;
}

/* TOUCH CONTROLS */
.controls{
  position:fixed;
  bottom:10px;
  left:0;
  right:0;
  height:120px;
  pointer-events:none;
}
.btn{
  pointer-events:auto;
  position:absolute;
  width:70px;
  height:70px;
  border-radius:50%;
  background:rgba(0,0,0,.4);
  color:white;
  font-size:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  user-select:none;
}
.btn:active{background:rgba(255,255,255,.4)}

#left{left:20px;bottom:20px}
#right{left:110px;bottom:20px}
#jump{right:110px;bottom:20px}
#shoot{right:20px;bottom:20px}
</style>
</head>
<body>

<div id="rotateHint">ÐŸÐ¾Ð²ÐµÑ€Ð½Ð¸ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð¾ ðŸ“±â†”</div>

<canvas id="game"></canvas>

<div class="controls">
  <div class="btn" id="left">â—€</div>
  <div class="btn" id="right">â–¶</div>
  <div class="btn" id="jump">â¤’</div>
  <div class="btn" id="shoot">ðŸ”«</div>
</div>

<script>
/* ================= FULLSCREEN LIKE ================= */
function hideAddressBar(){
  setTimeout(()=>window.scrollTo(0,1),100);
}

/* ================= CANVAS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let FLOOR;

/* ================= ASSETS ================= */
const playerImg = new Image();
const milkImg   = new Image();
const enemyImg  = new Image();
const beshikImg = new Image();
const bulletImg = new Image();
const eatSound  = new Audio("voice.mp3");

let assetsLoaded=false;
function loadAssets(){
  if(assetsLoaded) return;
  playerImg.src="photo.png";
  milkImg.src="milk.png";
  enemyImg.src="doctor.png";
  beshikImg.src="beshik.png";
  bulletImg.src="bez.png";
  eatSound.load();
  assetsLoaded=true;
}

/* ================= PLAYER ================= */
const player={
  x:100,
  size:150,
  y:0,
  vx:0,
  vy:0,
  speed:5,
  jump:-18,
  onGround:false
};
const PLAYER_Y_OFFSET = player.size * 0.2;

/* ================= RESIZE ================= */
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  FLOOR = innerHeight * 0.85;

  player.y = FLOOR - player.size + PLAYER_Y_OFFSET;
  player.vy = 0;
  player.onGround = true;
}
addEventListener("resize", resize);

/* ================= INPUT ================= */
const input={left:false,right:false,jump:false,shoot:false};
function bind(id,key){
  const el=document.getElementById(id);
  el.addEventListener("touchstart",e=>{
    e.preventDefault();
    input[key]=true;
  },{passive:false});
  el.addEventListener("touchend",()=>input[key]=false);
}
bind("left","left");
bind("right","right");
bind("jump","jump");
bind("shoot","shoot");

/* ================= OBJECTS ================= */
const milks=[];
const bullets=[];
let enemy=null;
let lastShot=0;

/* ================= SPAWN ================= */
setInterval(()=>{
  milks.push({
    x:innerWidth+100,
    y:FLOOR-100+PLAYER_Y_OFFSET,
    size:100,
    vx:-3
  });
},5000);

function spawnEnemy(){
  const isBeshik = Math.random() < 0.5;

  enemy={
    type:isBeshik?"beshik":"doctor",
    img:isBeshik?beshikImg:enemyImg,
    x:innerWidth+300,
    y:FLOOR-(isBeshik?200:120)+PLAYER_Y_OFFSET,
    size:isBeshik?200:120,
    vx:isBeshik?-3:-2,
    hp:isBeshik?1:3,
    maxHp:isBeshik?1:3,
    alive:true
  };
}
spawnEnemy();
setInterval(spawnEnemy,12000);

/* ================= GAME ================= */
const GRAVITY=0.8;

function enemyVisible(){
  return enemy &&
         enemy.alive &&
         enemy.x + enemy.size > 0 &&
         enemy.x < canvas.width;
}

function update(){
  player.vx=0;
  if(input.left) player.vx=-player.speed;
  if(input.right) player.vx=player.speed;

  if(input.jump && player.onGround){
    player.vy=player.jump;
    player.onGround=false;
  }

  if(input.shoot && performance.now()-lastShot>1500){
    bullets.push({
      x:player.x+player.size,
      y:player.y+player.size/2-20,
      size:80,
      vx:6
    });
    lastShot=performance.now();
  }

  player.vy+=GRAVITY;
  player.x+=player.vx;

  if(player.x<0) player.x=0;
  if(player.x+player.size>canvas.width){
    player.x=canvas.width-player.size;
  }

  player.y+=player.vy;
  if(player.y+player.size-PLAYER_Y_OFFSET>=FLOOR){
    player.y=FLOOR-player.size+PLAYER_Y_OFFSET;
    player.vy=0;
    player.onGround=true;
  }

  milks.forEach(m=>m.x+=m.vx);
  for(let i=milks.length-1;i>=0;i--){
    if(collide(player,milks[i])){
      eatSound.currentTime=0;
      eatSound.play().catch(()=>{});
      milks.splice(i,1);
    }
  }

  if(enemy && enemy.alive) enemy.x+=enemy.vx;
  bullets.forEach(b=>b.x+=b.vx);

  for(let i=bullets.length-1;i>=0;i--){
    if(enemyVisible() && collide(bullets[i],enemy)){
      enemy.hp--;
      bullets.splice(i,1);
      if(enemy.hp<=0) enemy.alive=false;
    }
  }
}

/* ================= COLLISION ================= */
function collide(a,b){
  return a.x<b.x+b.size &&
         a.x+a.size>b.x &&
         a.y<b.y+b.size &&
         a.y+a.size>b.y;
}

/* ================= DRAW ================= */
function draw(){
  ctx.fillStyle="#5c94fc";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#3cb043";
  ctx.fillRect(0,FLOOR,canvas.width,canvas.height-FLOOR);

  ctx.imageSmoothingEnabled=false;
  ctx.drawImage(playerImg,player.x,player.y,player.size,player.size);

  milks.forEach(m=>ctx.drawImage(milkImg,m.x,m.y,m.size,m.size));

  if(enemyVisible()){
    ctx.drawImage(enemy.img,enemy.x,enemy.y,enemy.size,enemy.size);

    /* ===== HP BAR ===== */
    let barWidth =
      enemy.type === "beshik"
        ? enemy.size / 3     // ðŸ”¥ Ð² 3 Ñ€Ð°Ð·Ð° ÐºÐ¾Ñ€Ð¾Ñ‡Ðµ
        : enemy.size;

    let barX = enemy.x + (enemy.size - barWidth) / 2;

    ctx.fillStyle="red";
    ctx.fillRect(barX,enemy.y-15,barWidth,8);

    ctx.fillStyle="lime";
    ctx.fillRect(
      barX,
      enemy.y-15,
      barWidth*(enemy.hp/enemy.maxHp),
      8
    );
  }

  bullets.forEach(b=>ctx.drawImage(bulletImg,b.x,b.y,b.size,b.size));
}

/* ================= LOOP ================= */
let started=false;
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

function startGame(){
  if(started) return;
  hideAddressBar();
  loadAssets();
  resize();
  started=true;
  loop();
}

/* ================= ORIENTATION ================= */
const hint=document.getElementById("rotateHint");
function checkOrientation(){
  if(innerWidth>innerHeight){
    hint.style.display="none";
    startGame();
  }else{
    hint.style.display="flex";
  }
}
addEventListener("resize",checkOrientation);
addEventListener("orientationchange",checkOrientation);
checkOrientation();
</script>
</body>
</html>
