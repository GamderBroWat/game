<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>TAP RUSH</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(180deg, #0f2027, #203a43, #2c5364);
    color: #fff;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overscroll-behavior: none;
}

#app {
    width: 100%;
    max-width: 420px;
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 16px;
    box-sizing: border-box;
}

h1 {
    text-align: center;
    margin: 8px 0 16px;
    font-size: 28px;
}

#login {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 40px;
}

input {
    padding: 14px;
    font-size: 18px;
    border-radius: 12px;
    border: none;
    outline: none;
}

button {
    padding: 16px;
    font-size: 22px;
    border-radius: 16px;
    border: none;
    background: #00e0ff;
    color: #00323a;
    font-weight: 700;
}

button:active {
    transform: scale(0.97);
}

#game {
    display: none;
    flex: 1;
    flex-direction: column;
}

#tapBtn {
    flex: 1;
    margin: 16px 0;
    font-size: 32px;
    background: #00ff9c;
    color: #003a23;
}

#players {
    background: rgba(255,255,255,0.08);
    border-radius: 12px;
    padding: 12px;
    max-height: 40vh;
    overflow-y: auto;
}

.player {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    font-size: 18px;
}

.leader {
    color: #00ff9c;
    font-weight: 700;
}
</style>
</head>
<body>

<div id="app">
    <h1>⚡ TAP RUSH</h1>

    <div id="login">
        <input id="nickname" placeholder="Введите никнейм">
        <button id="startBtn">Войти в игру</button>
    </div>

    <div id="game">
        <button id="tapBtn">TAP!</button>
        <div id="players"></div>
    </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCnJQPTInx6HF6KarGXBYGQslKanlxLl7M",
  authDomain: "arrowgame-94ba7.firebaseapp.com",
  projectId: "arrowgame-94ba7",
  storageBucket: "arrowgame-94ba7.firebasestorage.app",
  messagingSenderId: "757768926376",
  appId: "1:757768926376:web:d4e3fa371a0b0f02a67e9d",
  databaseURL: "https://arrowgame-94ba7-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

const loginEl = document.getElementById("login");
const gameEl = document.getElementById("game");
const playersEl = document.getElementById("players");
const tapBtn = document.getElementById("tapBtn");

let uid = null;
let myScore = 0;
let myRef = null;

document.getElementById("startBtn").onclick = async () => {
    const nick = document.getElementById("nickname").value.trim();
    if (!nick) return alert("Введите никнейм");

    const result = await auth.signInAnonymously();
    uid = result.user.uid;

    myRef = db.ref("players/" + uid);
    await myRef.set({
        nickname: nick,
        score: 0,
        lastTap: Date.now()
    });

    myRef.onDisconnect().remove();

    loginEl.style.display = "none";
    gameEl.style.display = "flex";
};

tapBtn.onclick = () => {
    myScore++;
    myRef.update({
        score: myScore,
        lastTap: Date.now()
    });
};

db.ref("players").on("value", snap => {
    const data = snap.val() || {};
    playersEl.innerHTML = "";

    const list = Object.values(data)
        .sort((a,b) => b.score - a.score);

    list.forEach((p, i) => {
        const div = document.createElement("div");
        div.className = "player" + (i === 0 ? " leader" : "");
        div.innerHTML = `<span>${p.nickname}</span><span>${p.score}</span>`;
        playersEl.appendChild(div);
    });
});
</script>

</body>
</html>