<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Vertical Dots â€” Multiplayer</title>

<style>
html, body {
	margin: 0;
	padding: 0;
	background: #0e0e11;
	color: white;
	font-family: system-ui, sans-serif;
	height: 100%;
	overflow: hidden;
}

#login {
	position: absolute;
	inset: 0;
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	gap: 12px;
	background: #0e0e11;
}

input, button {
	font-size: 18px;
	padding: 10px 14px;
	border-radius: 8px;
	border: none;
}

button {
	background: #4cafef;
	color: black;
	font-weight: 600;
}

#game {
	display: none;
	position: absolute;
	inset: 0;
}

canvas {
	width: 100%;
	height: 100%;
	touch-action: none;
}

#hud {
	position: absolute;
	top: 8px;
	left: 8px;
	font-size: 14px;
	opacity: 0.85;
}
</style>
</head>

<body>

<div id="login">
	<h2>Vertical Dots</h2>
	<input id="nickname" placeholder="Ð¢Ð²Ð¾Ð¹ Ð½Ð¸Ðº" maxlength="12" />
	<button id="start">Ð˜Ð³Ñ€Ð°Ñ‚ÑŒ</button>
</div>

<div id="game">
	<div id="hud"></div>
	<canvas id="canvas"></canvas>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
/* ðŸ”¥ Ð’Ð¡Ð¢ÐÐ’Ð¬ Ð¡Ð®Ð”Ð Ð¡Ð’ÐžÐ™ FIREBASE CONFIG */
const firebaseConfig = {
	apiKey: "YOUR_API_KEY",
	authDomain: "YOUR_PROJECT.firebaseapp.com",
	databaseURL: "https://YOUR_PROJECT.firebaseio.com",
	projectId: "YOUR_PROJECT",
	appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let W, H;
let me = null;
let players = {};
let orb = { x: 0.5, y: 0.5 };

function resize() {
	W = canvas.width = window.innerWidth;
	H = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

document.getElementById("start").onclick = async () => {
	const name = document.getElementById("nickname").value.trim();
	if (!name) return;

	document.getElementById("login").style.display = "none";
	document.getElementById("game").style.display = "block";

	const cred = await auth.signInAnonymously();
	const id = cred.user.uid;

	me = {
		id,
		name,
		y: 0.5,
		score: 0,
		color: `hsl(${Math.random()*360},70%,60%)`
	};

	const ref = db.ref("players/" + id);
	ref.set(me);
	ref.onDisconnect().remove();

	db.ref("players").on("value", snap => {
		players = snap.val() || {};
	});

	db.ref("orb").on("value", snap => {
		if (snap.exists()) orb = snap.val();
	});

	control();
	loop();
};

function control() {
	let up = false;

	const press = () => up = true;
	const release = () => up = false;

	canvas.addEventListener("touchstart", press);
	canvas.addEventListener("touchend", release);
	canvas.addEventListener("mousedown", press);
	canvas.addEventListener("mouseup", release);

	setInterval(() => {
		if (!me) return;
		me.y += up ? -0.01 : 0.01;
		me.y = Math.max(0.05, Math.min(0.95, me.y));

		checkOrb();
		db.ref("players/" + me.id).update({
			y: me.y,
			score: me.score
		});
	}, 100);
}

function checkOrb() {
	const dx = 0.5 - orb.x;
	const dy = me.y - orb.y;
	if (Math.hypot(dx, dy) < 0.05) {
		me.score++;
		db.ref("orb").set({
			x: 0.2 + Math.random()*0.6,
			y: 0.1 + Math.random()*0.8
		});
	}
}

function loop() {
	ctx.clearRect(0,0,W,H);

	// orb
	ctx.fillStyle = "#ffd54f";
	ctx.beginPath();
	ctx.arc(W*orb.x, H*orb.y, 8, 0, Math.PI*2);
	ctx.fill();

	let hud = "";

	for (let id in players) {
		const p = players[id];
		const x = W*0.5;
		const y = H*p.y;

		ctx.fillStyle = p.color;
		ctx.beginPath();
		ctx.arc(x, y, 12, 0, Math.PI*2);
		ctx.fill();

		hud += `${p.name}: ${p.score}<br>`;
	}

	document.getElementById("hud").innerHTML = hud;

	requestAnimationFrame(loop);
}
</script>

</body>
</html>