<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mario Mobile</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<style>
html,body{
  margin:0;padding:0;overflow:hidden;
  background:#5c94fc;touch-action:none;height:100%;
}
canvas{display:block}
#rotateHint{
  position:fixed;inset:0;background:#5c94fc;color:white;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;z-index:999;
}
.controls{position:fixed;bottom:10px;left:0;right:0;height:120px;pointer-events:none;}
.btn{
  pointer-events:auto;position:absolute;width:70px;height:70px;
  border-radius:50%;background:rgba(0,0,0,.4);
  color:white;font-size:20px;display:flex;
  align-items:center;justify-content:center;
}
#left{left:20px;bottom:20px}
#right{left:110px;bottom:20px}
#jump{right:110px;bottom:20px}
#shoot{right:20px;bottom:20px}
</style>
</head>
<body>

<div id="rotateHint">ÐŸÐ¾Ð²ÐµÑ€Ð½Ð¸ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð¾ ðŸ“±â†”</div>
<canvas id="game"></canvas>

<div class="controls">
  <div class="btn" id="left">â—€</div>
  <div class="btn" id="right">â–¶</div>
  <div class="btn" id="jump">â¤’</div>
  <div class="btn" id="shoot">ðŸ”«</div>
</div>

<script>
/* ================= CANVAS ================= */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
let FLOOR;

/* ================= ASSETS ================= */
const playerImg=new Image();
const milkImg=new Image();
const enemyImg=new Image();
const beshikImg=new Image();
const bulletImg=new Image();
const pantherImg=new Image();

const eatSound=new Audio("voice.mp3");
const pantherSong=new Audio("song.mp3"); // ðŸŽµ ÐŸÐÐÐ¢Ð•Ð Ð

playerImg.src="photo.png";
milkImg.src="milk.png";
enemyImg.src="doctor.png";
beshikImg.src="beshik.png";
bulletImg.src="bez.png";
pantherImg.src="Panther.png";

/* ================= PLAYER ================= */
const player={
  x:100,y:0,size:150,vx:0,vy:0,
  speed:5,jump:-18,onGround:false
};
const PLAYER_Y_OFFSET=player.size*0.2;

/* ================= RESIZE ================= */
function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
  FLOOR=innerHeight*0.85;
  player.y=FLOOR-player.size+PLAYER_Y_OFFSET;
  player.onGround=true;
}
addEventListener("resize",resize);

/* ================= INPUT ================= */
const input={left:false,right:false,jump:false,shoot:false};
["left","right","jump","shoot"].forEach(k=>{
  const el=document.getElementById(k);
  el.addEventListener("touchstart",e=>{e.preventDefault();input[k]=true;},{passive:false});
  el.addEventListener("touchend",()=>input[k]=false);
});

/* ================= OBJECTS ================= */
const milks=[];
const bullets=[];
let enemy=null;
let lastShot=0;

/* ================= ENEMY ================= */
function spawnEnemy(){
  const isBeshik=Math.random()<0.5;
  enemy={
    type:isBeshik?"beshik":"doctor",
    img:isBeshik?beshikImg:enemyImg,
    x:canvas.width+300,
    y:FLOOR-(isBeshik?200:120)+PLAYER_Y_OFFSET,
    size:isBeshik?200:120,
    vx:isBeshik?-3:-2,
    hp:isBeshik?1:3,
    maxHp:isBeshik?1:3,
    alive:true
  };
}
spawnEnemy();
setInterval(spawnEnemy,12000);

/* ================= PANTHER ================= */
let panther=null;

function spawnPanther(){
  panther={
    x:canvas.width+200,
    y:canvas.height*0.25,
    size:180,
    vx:-2,
    hasMilk:true,
    alive:true
  };

  /* ðŸŽµ Ð—ÐÐŸÐ£Ð¡Ðš ÐŸÐ•Ð¡ÐÐ˜ ÐžÐ”Ð˜Ð Ð ÐÐ— */
  pantherSong.currentTime = 0;
  pantherSong.play().catch(()=>{});
}

setTimeout(()=>{
  spawnPanther();
  setInterval(spawnPanther,8000);
},7000);

/* ================= GAME ================= */
const GRAVITY=0.8;
const MILK_SPEED=5;

function update(){
  /* PLAYER */
  player.vx=0;
  if(input.left) player.vx=-player.speed;
  if(input.right) player.vx=player.speed;

  if(input.jump&&player.onGround){
    player.vy=player.jump;
    player.onGround=false;
  }

  player.vy+=GRAVITY;
  player.x+=player.vx;
  player.y+=player.vy;

  if(player.x<0) player.x=0;
  if(player.x+player.size>canvas.width)
    player.x=canvas.width-player.size;

  if(player.y+player.size-PLAYER_Y_OFFSET>=FLOOR){
    player.y=FLOOR-player.size+PLAYER_Y_OFFSET;
    player.vy=0;player.onGround=true;
  }

  /* SHOOT */
  if(input.shoot&&performance.now()-lastShot>1000){
    bullets.push({
      x:player.x+player.size,
      y:player.y+player.size/2,
      size:80,vx:6
    });
    lastShot=performance.now();
  }
  bullets.forEach(b=>b.x+=b.vx);

  /* ENEMY */
  if(enemy&&enemy.alive){
    enemy.x+=enemy.vx;
    bullets.forEach((b,i)=>{
      if(collide(b,enemy)){
        enemy.hp--;
        bullets.splice(i,1);
        if(enemy.hp<=0) enemy.alive=false;
      }
    });
  }

  /* PANTHER */
  if(panther&&panther.alive){
    panther.x+=panther.vx;
    if(panther.hasMilk && panther.x<canvas.width*0.75){
      throwMilk();
      panther.hasMilk=false;
    }
    if(panther.x+panther.size<0) panther.alive=false;
  }

  /* HOMING MILK */
  milks.forEach(m=>{
    if(m.homing){
      const dx=(player.x+player.size/2)-(m.x);
      const dy=(player.y+player.size/2)-(m.y);
      const len=Math.hypot(dx,dy)||1;
      m.vx=(dx/len)*MILK_SPEED;
      m.vy=(dy/len)*MILK_SPEED;
    }
    m.x+=m.vx;
    m.y+=m.vy;
  });

  for(let i=milks.length-1;i>=0;i--){
    if(collide(player,milks[i])){
      eatSound.currentTime=0;
      eatSound.play().catch(()=>{});
      milks.splice(i,1);
    }
  }
}

function throwMilk(){
  milks.push({
    x:panther.x,
    y:panther.y+panther.size/2,
    size:80,
    vx:0,vy:0,
    homing:true
  });
}

/* ================= COLLISION ================= */
function collide(a,b){
  return a.x<b.x+b.size&&a.x+a.size>b.x&&
         a.y<b.y+b.size&&a.y+a.size>b.y;
}

/* ================= DRAW ================= */
function draw(){
  ctx.fillStyle="#5c94fc";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#3cb043";
  ctx.fillRect(0,FLOOR,canvas.width,canvas.height-FLOOR);

  ctx.drawImage(playerImg,player.x,player.y,player.size,player.size);

  if(enemy&&enemy.alive){
    ctx.drawImage(enemy.img,enemy.x,enemy.y,enemy.size,enemy.size);
    const barW=enemy.type==="beshik"?enemy.size/3:enemy.size;
    const barX=enemy.x+(enemy.size-barW)/2;
    ctx.fillStyle="red";
    ctx.fillRect(barX,enemy.y-15,barW,8);
    ctx.fillStyle="lime";
    ctx.fillRect(barX,enemy.y-15,barW*(enemy.hp/enemy.maxHp),8);
  }

  if(panther&&panther.alive){
    ctx.drawImage(pantherImg,panther.x,panther.y,panther.size,panther.size);
    if(panther.hasMilk)
      ctx.drawImage(milkImg,panther.x-40,panther.y+panther.size/2,60,60);
  }

  milks.forEach(m=>ctx.drawImage(milkImg,m.x,m.y,m.size,m.size));
  bullets.forEach(b=>ctx.drawImage(bulletImg,b.x,b.y,b.size,b.size));
}

/* ================= LOOP ================= */
function loop(){update();draw();requestAnimationFrame(loop);}
function startGame(){resize();loop();}

/* ================= ORIENTATION ================= */
const hint=document.getElementById("rotateHint");
function checkOrientation(){
  if(innerWidth>innerHeight){hint.style.display="none";startGame();}
  else hint.style.display="flex";
}
addEventListener("resize",checkOrientation);
checkOrientation();
</script>
</body>
</html>