<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>DOT ARENA</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #0b1020;
    color: white;
    font-family: system-ui, sans-serif;
    overflow: hidden;
}

#login {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 14px;
}

input, button {
    font-size: 20px;
    padding: 14px;
    border-radius: 14px;
    border: none;
}

button {
    background: #00ffd0;
    font-weight: 700;
}

canvas {
    display: none;
}
</style>
</head>
<body>

<div id="login">
    <h1>ðŸŸ¢ DOT ARENA</h1>
    <input id="nick" placeholder="ÐÐ¸ÐºÐ½ÐµÐ¹Ð¼">
    <button id="enter">Ð’Ð¾Ð¹Ñ‚Ð¸</button>
</div>

<canvas id="game"></canvas>

<script>
// ðŸ”¥ Firebase (Ð¢Ð’ÐžÐ™)
firebase.initializeApp({
  apiKey: "AIzaSyAViU2ttzIWAmmxB6tSwJ0thCrCTba7Cyk",
  authDomain: "best-ec082.firebaseapp.com",
  projectId: "best-ec082",
  storageBucket: "best-ec082.firebasestorage.app",
  messagingSenderId: "782817955265",
  appId: "1:782817955265:web:0265b75bb0bfb4884bb340",
  databaseURL: "https://best-ec082-default-rtdb.firebaseio.com/"
});

const auth = firebase.auth();
const db = firebase.database();

/* UI */
const login = document.getElementById("login");
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let uid;
let me;
let players = {};

/* Resize */
function resize() {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
}
window.addEventListener("resize", resize);

/* Login */
document.getElementById("enter").onclick = async () => {
    const nickname = nick.value.trim();
    if (!nickname) return alert("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¸Ðº");

    const res = await auth.signInAnonymously();
    uid = res.user.uid;

    me = {
        nickname,
        x: innerWidth / 2,
        y: innerHeight / 2,
        score: 0,
        color: `hsl(${Math.random()*360},80%,60%)`
    };

    const ref = db.ref("players/" + uid);
    ref.set(me);
    ref.onDisconnect().remove();

    login.style.display = "none";
    canvas.style.display = "block";
    resize();

    canvas.addEventListener("touchmove", e => {
        const t = e.touches[0];
        me.x = t.clientX;
        me.y = t.clientY;
        me.score += 0.03;
        ref.update({ x: me.x, y: me.y, score: me.score });
    });

    loop();
};

/* Sync */
db.ref("players").on("value", snap => {
    players = snap.val() || {};
});

/* Render loop */
function loop() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    for (const id in players) {
        const p = players[id];
        ctx.beginPath();
        ctx.arc(p.x, p.y, 22, 0, Math.PI*2);
        ctx.fillStyle = p.color;
        ctx.fill();

        ctx.fillStyle = "#fff";
        ctx.font = "14px system-ui";
        ctx.textAlign = "center";
        ctx.fillText(p.nickname, p.x, p.y - 30);
        ctx.fillText(Math.floor(p.score), p.x, p.y + 42);
    }

    requestAnimationFrame(loop);
}
</script>
</body>
</html>