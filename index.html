<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mario Mobile</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#5c94fc;
  touch-action:none;
}
canvas{display:block}

/* MOBILE CONTROLS */
.controls{
  position:fixed;
  bottom:10px;
  left:0;
  right:0;
  height:120px;
  pointer-events:none;
}
.btn{
  pointer-events:auto;
  position:absolute;
  width:80px;
  height:80px;
  border-radius:50%;
  background:rgba(0,0,0,0.4);
  color:white;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  user-select:none;
}
.btn:active{background:rgba(255,255,255,0.4)}

#left{left:20px;bottom:20px}
#right{left:120px;bottom:20px}
#jump{right:120px;bottom:20px}
#shoot{right:20px;bottom:20px}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div class="controls">
  <div class="btn" id="left">◀</div>
  <div class="btn" id="right">▶</div>
  <div class="btn" id="jump">⤒</div>
  <div class="btn" id="shoot">●</div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

const DPR=window.devicePixelRatio||1;
function resize(){
  canvas.width=innerWidth*DPR;
  canvas.height=innerHeight*DPR;
  canvas.style.width=innerWidth+"px";
  canvas.style.height=innerHeight+"px";
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener("resize",resize);
resize();

const FLOOR=innerHeight*0.85;
const GRAVITY=0.8;

// INPUT STATE
const input={left:false,right:false,jump:false,shoot:false};

// TOUCH BUTTONS
function bind(id,key){
  const el=document.getElementById(id);
  el.addEventListener("touchstart",e=>{e.preventDefault();input[key]=true},{passive:false});
  el.addEventListener("touchend",()=>input[key]=false);
}
bind("left","left");
bind("right","right");
bind("jump","jump");
bind("shoot","shoot");

// IMAGES
const playerImg=new Image();playerImg.src="photo.png";
const milkImg=new Image();milkImg.src="milk.png";
const enemyImg=new Image();enemyImg.src="doctor.png";
const bulletImg=new Image();bulletImg.src="bez.png";

// SOUND
const eatSound=new Audio("voice.mp3");

// PLAYER
const player={
  x:100,size:300,
  y:FLOOR-300,
  vx:0,vy:0,
  speed:6,jump:-22,
  onGround:true
};

// MILK
const milks=[];
setInterval(()=>{
  milks.push({x:innerWidth+200,y:FLOOR-260,size:200,vx:-3});
},5000);

// ENEMY
let enemy=null;
function spawnEnemy(){
  enemy={x:innerWidth+300,y:FLOOR-240,size:240,vx:-2,hp:3,alive:true};
}
spawnEnemy();
setInterval(spawnEnemy,12000);

// BULLETS
const bullets=[];
let lastShot=0;

// UPDATE
function update(){
  player.vx=0;
  if(input.left) player.vx=-player.speed;
  if(input.right) player.vx=player.speed;

  if(input.jump && player.onGround){
    player.vy=player.jump;
    player.onGround=false;
  }

  if(input.shoot && performance.now()-lastShot>1000){
    bullets.push({
      x:player.x+player.size,
      y:player.y+player.size/2-40,
      size:160,
      vx:6
    });
    lastShot=performance.now();
  }

  player.vy+=GRAVITY;
  player.x+=player.vx;
  player.y+=player.vy;
  if(player.y+player.size>=FLOOR){
    player.y=FLOOR-player.size;
    player.vy=0;
    player.onGround=true;
  }

  milks.forEach(m=>m.x+=m.vx);
  for(let i=milks.length-1;i>=0;i--){
    if(collide(player,milks[i])){
      eatSound.currentTime=0;eatSound.play().catch(()=>{});
      const old=player.size;
      player.size*=1.1;
      player.y+=old-player.size;
      player.y=FLOOR-player.size;
      milks.splice(i,1);
    }
  }

  if(enemy&&enemy.alive) enemy.x+=enemy.vx;

  bullets.forEach(b=>b.x+=b.vx);
  for(let i=bullets.length-1;i>=0;i--){
    if(enemy&&enemy.alive&&collide(bullets[i],enemy)){
      enemy.hp--;bullets.splice(i,1);
      if(enemy.hp<=0) enemy.alive=false;
    }
  }
}

// COLLISION
function collide(a,b){
  return a.x<b.x+b.size&&a.x+a.size>b.x&&a.y<b.y+b.size&&a.y+a.size>b.y;
}

// DRAW
function draw(){
  ctx.fillStyle="#5c94fc";
  ctx.fillRect(0,0,innerWidth,innerHeight);

  ctx.fillStyle="#3cb043";
  ctx.fillRect(0,FLOOR,innerWidth,innerHeight);

  ctx.imageSmoothingEnabled=false;
  ctx.drawImage(playerImg,player.x,player.y,player.size,player.size);

  milks.forEach(m=>ctx.drawImage(milkImg,m.x,m.y,m.size,m.size));

  if(enemy&&enemy.alive){
    ctx.drawImage(enemyImg,enemy.x,enemy.y,enemy.size,enemy.size);
    ctx.fillStyle="red";
    ctx.fillRect(enemy.x,enemy.y-20,enemy.size,10);
    ctx.fillStyle="lime";
    ctx.fillRect(enemy.x,enemy.y-20,enemy.size*(enemy.hp/3),10);
  }

  bullets.forEach(b=>ctx.drawImage(bulletImg,b.x,b.y,b.size,b.size));
}

function loop(){
  update();draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
